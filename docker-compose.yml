version: '3.7'

x-build-args: &build_args
  INSTALL_PYTHON_VERSION: 3.7

services:
  delayed-jobs-server-dev:
    build:
      context: .
      target: development
      args:
        <<: *build_args
    image: chembl/delayed-jobs-server:dev
    ports:
    - "5000:5000"
  delayed-jobs-server-prod:
    build:
      context: .
      target: production
      args:
        <<: *build_args
    image: "$IMAGE_TAG"
    ports:
    - "8080:8080"
    environment:
      CONTEXT_PATH: '/unichem/beta'
    volumes:
      - nfs:/nfs/public/rw

volumes:
  nfs:
    driver: local
    driver_opts:
      type: nfs
      o: addr=10.7.125.110,rw
      device: ":/ifs/public-r/rw"